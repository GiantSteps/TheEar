#N canvas 386 162 861 438 10;
#N canvas 1 82 704 725 dsp 0;
#X obj 61 487 *~;
#X obj 28 487 *~;
#X obj 28 509 -~;
#X obj 177 485 *~;
#X obj 146 485 *~;
#X obj 146 507 +~;
#X obj 119 203 *~;
#X obj 88 203 *~;
#X obj 60 203 *~;
#X obj 29 203 *~;
#X obj 29 228 +~;
#X obj 137 389 *~;
#X obj 30 632 *~;
#X obj 248 440 rfft~;
#X obj 118 171 rfft~;
#X obj 29 574 rifft~;
#X obj 31 656 outlet~;
#X obj 107 389 *~;
#X obj 107 411 +~;
#X obj 134 228 -~;
#X obj 28 441 *~;
#X obj 61 442 *~;
#X obj 137 632 r window-size;
#X obj 360 604 r window-size;
#X obj 360 653 block~;
#X obj 29 359 +~ 1e-15;
#X obj 29 608 *~;
#X obj 137 653 expr 2/(3*$f1);
#X obj 525 572 loadbang;
#X msg 360 628 set \$1 4;
#X obj 107 435 q8_rsqrt~;
#N canvas 1 82 1265 746 read-windows 0;
#X obj 18 693 *~;
#X obj 364 448 r window-size;
#X obj 156 300 f;
#X obj 102 91 r window-size;
#X obj 102 139 /;
#X obj 195 695 *~;
#X obj 156 255 bang~;
#X obj 17 551 line~;
#X obj 102 164 * 1000;
#X obj 288 224 r speed;
#X obj 198 302 +;
#X obj 288 272 *;
#X obj 183 470 +;
#X obj 143 446 t f f;
#X msg 17 523 \$1 \, \$2 \$3;
#X obj 17 496 pack 0 0 0;
#X obj 178 371 / 1000;
#X obj 156 394 *;
#X text 188 394 reading location (samples);
#X obj 51 597 / 4;
#X obj 288 245 * 0.01;
#X floatatom 364 498 7 0 0 0 - - -;
#X obj 364 474 *;
#X obj 502 369 * 0.01;
#X obj 504 390 + 69;
#X obj 505 411 mtof;
#X obj 505 433 / 440;
#X obj 399 474 t b f;
#X obj 19 719 outlet~;
#X obj 195 720 outlet~;
#X msg 803 409 0;
#X obj 803 432 s speed;
#X obj 768 508 r speed;
#X msg 768 532 set \$1;
#X obj 768 557 s speed-set;
#X text 432 498 stretched window size (samples);
#X msg 877 533 set \$1;
#X msg 825 286 set \$1;
#X obj 808 140 t b f;
#X obj 826 257 f;
#X obj 754 171 int;
#X obj 754 203 sel 0;
#X msg 813 174 1;
#X msg 813 197 0;
#X obj 754 228 del 300;
#X obj 528 586 r rewind;
#X floatatom 111 187 5 0 0 0 - - -;
#X obj 102 115 t f b;
#X obj 142 139 samplerate~;
#X obj 102 208 / 4;
#X obj 233 306 s see-loc;
#X obj 817 116 r see-loc;
#X obj 193 420 / 2;
#X obj 156 420 -;
#X text 229 417 back up 1/2 window;
#X obj 16 597 -~;
#X text 43 6 Read two windows out of the recorded sample \, one 1/4
ahead of the other. The mid point of the front window is specified
by "location". If "speed" is nonzero \, "location" automatically precesses.
;
#X obj 528 698 * -0.5;
#X text 91 587 "back" window 1/4 cycle behind "front" one;
#X text 137 205 computation period (msec) for overlap of 4;
#X text 164 186 msec in a window;
#X obj 528 659 /;
#X obj 528 678 * 1000;
#X obj 528 625 t f b;
#X obj 568 642 samplerate~;
#X obj 528 606 f;
#X msg 845 711 \; rewind bang \; speed \$1;
#X obj 845 684 r auto;
#X obj 730 685 r no-detune;
#X msg 730 707 \; detune 0;
#X text 321 280 loop to precess the location according;
#X text 320 296 to the "speed" parameter.;
#X text 611 31 if location changes \, update number box;
#X text 610 50 in main window via "location-set" \, but;
#X text 613 69 taking care to limit frequency of updates.;
#X text 756 462 reflect control changes;
#X text 756 479 in main window.;
#X text 754 344 setting location by hand;
#X text 752 362 sets speed to zero.;
#X text 760 653 misc controls;
#X text 496 527 "rewind" control takes us;
#X text 499 545 to a location depending on;
#X text 499 564 stretched window size.;
#X obj 593 457 t b f;
#X obj 617 395 samplerate~;
#X obj 593 418 /;
#X obj 505 455 * 1;
#X text 494 312 desired transposition and sample;
#X text 494 329 rate correction for soundfile;
#X obj 593 370 t f b;
#X obj 143 525 s table-read-point;
#X obj 143 501 change;
#X obj 218 664 tabreceive~ \$1-hann;
#X obj 593 348 r \$1-insamprate;
#X obj 178 347 r \$1-insamprate;
#X obj 17 637 tabread4~ \$1-sample;
#X obj 194 637 tabread4~ \$1-sample;
#X obj 178 276 r \$1-location;
#X obj 803 386 r \$1-location;
#X obj 808 94 r \$1-location;
#X msg 528 718 \; \$1-location \$1;
#X obj 854 307 s \$1-location-set;
#X obj 502 346 r \$1-transpo;
#X obj 877 507 r \$1-transpo;
#X obj 877 558 s \$1-transpo-set;
#X connect 0 0 28 0;
#X connect 1 0 22 0;
#X connect 2 0 10 0;
#X connect 2 0 17 0;
#X connect 3 0 47 0;
#X connect 4 0 8 0;
#X connect 5 0 29 0;
#X connect 6 0 2 0;
#X connect 7 0 55 0;
#X connect 7 0 96 0;
#X connect 8 0 46 0;
#X connect 8 0 49 0;
#X connect 9 0 20 0;
#X connect 10 0 2 1;
#X connect 10 0 50 0;
#X connect 11 0 10 1;
#X connect 12 0 15 1;
#X connect 13 0 15 0;
#X connect 13 0 91 0;
#X connect 13 1 12 0;
#X connect 14 0 7 0;
#X connect 15 0 14 0;
#X connect 16 0 17 1;
#X connect 17 0 53 0;
#X connect 19 0 55 1;
#X connect 20 0 11 0;
#X connect 21 0 19 0;
#X connect 21 0 12 1;
#X connect 21 0 52 0;
#X connect 21 0 65 1;
#X connect 22 0 21 0;
#X connect 23 0 24 0;
#X connect 24 0 25 0;
#X connect 25 0 26 0;
#X connect 26 0 86 0;
#X connect 27 0 22 0;
#X connect 27 1 22 1;
#X connect 30 0 31 0;
#X connect 32 0 33 0;
#X connect 33 0 34 0;
#X connect 36 0 104 0;
#X connect 38 0 40 0;
#X connect 38 1 39 1;
#X connect 40 0 41 0;
#X connect 41 0 42 0;
#X connect 41 0 44 0;
#X connect 42 0 40 1;
#X connect 43 0 40 1;
#X connect 44 0 43 0;
#X connect 44 0 39 0;
#X connect 45 0 65 0;
#X connect 47 0 4 0;
#X connect 47 1 48 0;
#X connect 48 0 4 1;
#X connect 49 0 15 2;
#X connect 49 0 11 1;
#X connect 51 0 38 0;
#X connect 52 0 53 1;
#X connect 53 0 13 0;
#X connect 55 0 95 0;
#X connect 57 0 100 0;
#X connect 61 0 62 0;
#X connect 62 0 57 0;
#X connect 63 0 61 0;
#X connect 63 1 64 0;
#X connect 64 0 61 1;
#X connect 65 0 63 0;
#X connect 67 0 66 0;
#X connect 68 0 69 0;
#X connect 83 0 86 0;
#X connect 83 1 86 1;
#X connect 84 0 85 1;
#X connect 85 0 83 0;
#X connect 86 0 27 0;
#X connect 89 0 85 0;
#X connect 89 1 84 0;
#X connect 91 0 90 0;
#X connect 92 0 5 1;
#X connect 92 0 0 1;
#X connect 93 0 89 0;
#X connect 94 0 16 0;
#X connect 95 0 0 0;
#X connect 96 0 5 0;
#X connect 97 0 2 1;
#X connect 98 0 30 0;
#X connect 99 0 38 0;
#X connect 102 0 23 0;
#X connect 103 0 36 0;
#X restore 119 143 pd read-windows;
#X text 282 15 recall previous output amplitude. Its phase will be
added to the phase difference we measure from two windows in the the
recorded sound.;
#X obj 131 79 *~;
#X obj 99 79 *~;
#X obj 99 101 +~;
#X obj 169 104 q8_rsqrt~;
#X obj 169 81 +~ 1e-20;
#X obj 83 129 *~;
#X obj 29 128 *~;
#X obj 191 300 r lock;
#X obj 39 255 lrshift~ 1;
#X obj 34 279 lrshift~ -1;
#X obj 151 255 lrshift~ 1;
#X obj 143 279 lrshift~ -1;
#X obj 45 310 *~;
#X obj 169 322 *~;
#X obj 29 335 +~;
#X obj 135 341 +~;
#X text 257 76 divide by the magnitude to make a unit-magnitude complex
amplitude (phase only). The 1e-20 is to prevent overflows. q8_rsqrt~
is reciprocal square root.;
#X text 257 175 Take FT of the window in back. Multiply its conjugate
by the normalized previous output. The result has the magnitude of
the input sound and phase (previous output phase) minus (back window
phase).;
#X text 259 380 Normalize again \, this time taking care to salt each
channel with 1e-15 so that we get a unit complex number even if everything
was zero heretofore.;
#X text 298 437 Now take the FT of the forward window and multiply
it by the unit complex number from above. The magnitude will be that
of the forward window and the phase will be the previous output phase
plus the phase difference between the two analysis windows -- except
that if "lock" is on \, they will be modified to agree progressively
better with the inter-channel phase relationships of the input.;
#X text 259 252 If "lock" is on \, encourage neighboring channels to
stay in phase by adding the two neighboring complex amplitudes. The
result will tend toward the channel with the strongest amplitude. If
the phase relationships between channels in the output and those in
the input are in parallel \, then neighboring channels of the quotient
will all have the same phase and this will not change any phases. (lrshift
shifts the signal to the left or right depending on its argument.)
;
#X text 321 569 'set' message to block;
#X text 324 586 allows variable size;
#X text 269 136 Read two windows \, one 1/4 length behind the other
\, of the input sound \, with Hann window function (see inside).;
#X obj 30 18 tabreceive~ \$1-prev-real;
#X obj 83 39 tabreceive~ \$1-prev-imag;
#X obj 147 553 tabsend~ \$1-prev-imag;
#X obj 146 577 tabsend~ \$1-prev-real;
#X obj 62 608 tabreceive~ \$1-hann;
#X msg 525 597 \; pd dsp 1 \; window-size 2048 \; rewind bang;
#X connect 0 0 2 1;
#X connect 1 0 2 0;
#X connect 2 0 15 0;
#X connect 2 0 60 0;
#X connect 3 0 5 1;
#X connect 4 0 5 0;
#X connect 5 0 15 1;
#X connect 5 0 59 0;
#X connect 6 0 19 1;
#X connect 7 0 19 0;
#X connect 8 0 10 1;
#X connect 9 0 10 0;
#X connect 10 0 42 0;
#X connect 10 0 41 0;
#X connect 10 0 47 0;
#X connect 11 0 18 1;
#X connect 12 0 16 0;
#X connect 13 0 1 1;
#X connect 13 0 3 1;
#X connect 13 1 0 1;
#X connect 13 1 4 1;
#X connect 14 0 9 1;
#X connect 14 0 7 1;
#X connect 14 1 6 1;
#X connect 14 1 8 1;
#X connect 15 0 26 0;
#X connect 17 0 18 0;
#X connect 18 0 30 0;
#X connect 19 0 43 0;
#X connect 19 0 44 0;
#X connect 19 0 48 0;
#X connect 20 0 1 0;
#X connect 20 0 4 0;
#X connect 21 0 0 0;
#X connect 21 0 3 0;
#X connect 22 0 27 0;
#X connect 23 0 29 0;
#X connect 25 0 17 1;
#X connect 25 0 17 0;
#X connect 25 0 20 0;
#X connect 26 0 12 0;
#X connect 27 0 12 1;
#X connect 28 0 62 0;
#X connect 29 0 24 0;
#X connect 30 0 20 1;
#X connect 30 0 21 1;
#X connect 31 0 14 0;
#X connect 31 1 13 0;
#X connect 33 0 35 1;
#X connect 34 0 35 0;
#X connect 35 0 37 0;
#X connect 36 0 38 1;
#X connect 36 0 39 1;
#X connect 37 0 36 0;
#X connect 38 0 8 0;
#X connect 38 0 7 0;
#X connect 39 0 9 0;
#X connect 39 0 6 0;
#X connect 40 0 45 1;
#X connect 40 0 46 1;
#X connect 41 0 45 0;
#X connect 42 0 45 0;
#X connect 43 0 46 0;
#X connect 44 0 46 0;
#X connect 45 0 47 1;
#X connect 46 0 48 1;
#X connect 47 0 25 0;
#X connect 48 0 11 0;
#X connect 48 0 11 1;
#X connect 48 0 21 0;
#X connect 57 0 34 1;
#X connect 57 0 34 0;
#X connect 57 0 39 0;
#X connect 58 0 33 1;
#X connect 58 0 33 0;
#X connect 58 0 38 0;
#X connect 61 0 26 1;
#X restore 310 339 pd dsp;
#X floatatom 688 302 3 0 0 0 - speed-set -;
#N canvas 258 82 647 766 phase-tables 0;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$1-prev-imag 4096 float 0;
#X coords 0 1000 4096 -1000 400 300 1;
#X restore 169 326 graph;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$1-prev-real 4096 float 0;
#X coords 0 500 4096 -500 400 300 1;
#X restore 170 17 graph;
#X restore 437 296 pd phase-tables;
#X text 685 286 hundredths;
#X text 657 124 normal;
#N canvas 1 120 565 454 hann-window 0;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$1-hann 2048 float 0;
#X coords 0 1 2047 0 300 100 1;
#X restore 82 311 graph;
#X obj 378 165 osc~;
#X obj 378 190 *~ -0.5;
#X obj 378 214 +~ 0.5;
#X obj 37 88 r window-size;
#X obj 38 173 /;
#X obj 127 142 samplerate~;
#X obj 38 251 s window-sec;
#X obj 177 204 swap;
#X obj 177 228 /;
#X obj 177 252 s window-hz;
#X obj 49 201 * 1000;
#X obj 49 228 s window-msec;
#X obj 38 115 t f b f;
#X msg 173 92 resize \$1;
#X obj 330 105 r window-hz;
#X msg 382 130 0;
#X obj 330 131 t f b;
#X text 15 8 calculate Hann window table (variable window size) and
constants window-hz (fundamental frequency of analysis) \, window-sec
and window-msec (analysis window size in seconds and msec).;
#X obj 331 247 tabwrite~ \$1-hann;
#X obj 173 116 s \$1-hann;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 19 0;
#X connect 4 0 13 0;
#X connect 5 0 7 0;
#X connect 5 0 11 0;
#X connect 6 0 5 1;
#X connect 6 0 8 1;
#X connect 8 0 9 0;
#X connect 8 1 9 1;
#X connect 9 0 10 0;
#X connect 11 0 12 0;
#X connect 13 0 5 0;
#X connect 13 0 8 0;
#X connect 13 1 6 0;
#X connect 13 2 14 0;
#X connect 14 0 20 0;
#X connect 15 0 17 0;
#X connect 16 0 1 1;
#X connect 17 0 1 0;
#X connect 17 1 16 0;
#X connect 17 1 19 0;
#X restore 437 321 pd hann-window;
#N canvas 230 198 777 489 insample 0;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$1-sample 234438 float 0;
#X coords 0 1 234437 -1 400 150 1;
#X restore 282 104 graph;
#X obj 28 184 unpack s f;
#X obj 28 294 soundfiler;
#X obj 28 210 t s b;
#X obj 28 245 pack s s;
#X obj 83 156 44100;
#X obj 28 157 t a b;
#X obj 28 357 /;
#X obj 28 381 * 1000;
#X obj 276 20 inlet;
#X obj 322 42 openpanel;
#X obj 191 399 - 1;
#X msg 28 270 read -resize -maxsize 4.41e+07 \$1 \$2;
#X obj 125 184 s \$1-insamprate;
#X obj 84 209 symbol \$1-sample;
#X obj 38 318 s \$1-samplength;
#X obj 66 357 r \$1-insamprate;
#X obj 28 404 s \$1-samp-msec;
#X obj 276 67 s \$1-read-sample;
#X obj 28 133 r \$1-read-sample;
#X floatatom 159 314 10 0 0 0 - - -;
#X msg 191 420 \; \$1-location-set-set-properties range 0 \$1 \;;
#X connect 1 0 3 0;
#X connect 1 1 13 0;
#X connect 2 0 7 0;
#X connect 2 0 15 0;
#X connect 2 0 20 0;
#X connect 3 0 4 0;
#X connect 3 1 14 0;
#X connect 4 0 12 0;
#X connect 5 0 13 0;
#X connect 6 0 1 0;
#X connect 6 1 5 0;
#X connect 7 0 8 0;
#X connect 8 0 11 0;
#X connect 8 0 17 0;
#X connect 9 0 18 0;
#X connect 10 0 18 0;
#X connect 12 0 2 0;
#X connect 14 0 4 1;
#X connect 16 0 7 1;
#X connect 19 0 6 0;
#X restore 438 273 pd insample;
#X obj 688 326 s speed;
#X obj 666 354 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X obj 666 376 s rewind;
#X msg 613 101 200;
#X msg 613 123 100;
#X text 654 100 contract;
#X text 658 145 expand;
#X text 686 275 motion in;
#X msg 729 83 512;
#X msg 729 105 1024;
#X msg 729 127 2048;
#X msg 729 149 4096;
#X obj 729 171 s window-size;
#X text 729 50 window size \,;
#X text 729 65 samples;
#X text 770 82 <- set;
#X obj 613 172 s auto;
#X msg 613 145 20;
#X msg 102 308 set \$1;
#X obj 310 367 outlet~;
#X obj 438 197 symbol \$2;
#X obj 437 71 loadbang;
#X msg 459 152 bang;
#X obj 438 92 delay 100;
#X obj 525 53 inlet;
#X text 498 28 enter filename;
#X text 496 33 ______________;
#X obj 52 43 inlet;
#X obj 67 68 r \$1-samplength;
#X obj 67 120 / 100;
#X obj 67 85 / 44.1;
#X obj 52 170 *;
#X text 110 85 máxima location (secs);
#X text 89 144 centésima de location;
#X text 6 21 enra el punto de lectura del sample en porcentaje;
#X obj 293 80 inlet;
#X text 246 61 entra la transpo (halftones);
#X obj 293 152 * 100;
#X obj 52 200 s \$1-location;
#X obj 102 285 r \$1-location-set;
#X obj 102 331 s \$1-location-set-set-properties;
#X obj 293 186 s \$1-transpo;
#X obj 353 133 loadbang;
#X msg 353 166 0;
#X obj 438 216 makefilename %s.wav;
#X floatatom 136 122 5 0 0 0 - - -;
#X obj 67 146 int;
#X floatatom 148 182 5 0 0 0 - - -;
#X obj 239 275 r -0-location;
#X text 230 403 <- avoid error;
#X obj 115 402 r -23.22-location;
#X connect 0 0 26 0;
#X connect 1 0 7 0;
#X connect 8 0 9 0;
#X connect 10 0 23 0;
#X connect 11 0 23 0;
#X connect 15 0 19 0;
#X connect 16 0 19 0;
#X connect 17 0 19 0;
#X connect 18 0 19 0;
#X connect 24 0 23 0;
#X connect 27 0 51 0;
#X connect 28 0 30 0;
#X connect 29 0 27 0;
#X connect 30 0 27 0;
#X connect 31 0 51 0;
#X connect 34 0 38 0;
#X connect 35 0 37 0;
#X connect 36 0 53 0;
#X connect 37 0 36 0;
#X connect 37 0 52 0;
#X connect 38 0 45 0;
#X connect 42 0 44 0;
#X connect 44 0 48 0;
#X connect 49 0 50 0;
#X connect 50 0 48 0;
#X connect 51 0 6 0;
#X connect 53 0 38 1;
#X connect 53 0 54 0;
